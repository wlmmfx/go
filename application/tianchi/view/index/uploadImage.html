<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>欢迎使用！车辆智能识别系统</title>
    <style>
        .container {
            font-size: 1.5rem;
        }

        .progress {
            position: relative;
            width: 100%;
            height: 2.5rem;;
            border: 1px solid #ddd;
            padding: 2px;
            font-size: 18px;
        }

        .bar {
            background-color: #2c7659;
            width: 0%;
            height: 55px;
            border-radius: 3px;
            font-size: 18px;
        }

        .percent {
            position: absolute;
            display: inline-block;
            top: 15px;
            left: 48%;
            margin-bottom: 3px;
        }

        .list-group-item.active {
            background-color: #17a2b8;
            border-color: #17a2b8;
        }


    </style>
</head>
<body>

<div class="container" style="max-width: 100%;">
    <div class="jumbotron" style="margin-top: 30px; padding-top: 30px;">
        <h3>欢迎使用！车辆智能识别系统</h3>
        <hr>
        <font color="#dc143c">注意：数据库必须有客户信息表，否则无效。</font>
        <p>
            <form action="{:url('tianchi/index/uploadImageFrom')}" method="post" enctype="multipart/form-data">
                <div class="ace-file-input ace-file-multiple">
                    <div class="ace-file-input ace-file-multiple">
                        <input type="file" capture="camera" accept="image/*" id="id-input-file-3" class="chepai_file"
                               name="chepai_file">
                    </div>
                </div>
        <p></p>
        <input class="input-medium" type="hidden" name="id" value="123123">
        <button class="btn btn-info btn-block" type="submit" style="font-size: 1.2rem;">开始智能识别</button>
        <p></p>
        </form>
        <p></p>
        <div class="progress">
            <div class="bar"></div>
            <p></p>
            <div class="percent">0%</div>
        </div>
        <p></p>
        <div id="status">

        </div>
        </p>
        <div id="live_images">

        </div>
    </div>

</div>

<link href="https://cdn.bootcss.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery.form/4.2.2/jquery.form.js"></script>
<script>
    $(function () {
        var bar = $('.bar');
        var percent = $('.percent');
        var status = $('#status');
        $('form').ajaxForm({
            beforeSerialize: function () {
                //alert("表单数据序列化前执行的操作！");
                //$("#txt2").val("java");//如：改变元素的值
            },
            beforeSubmit: function () {
                //alert("表单提交前的操作");
                var limitFileSize = 9;
                var filesize = $("input[type='file']")[0].files[0].size / 1024 / 1024;
                console.log(filesize);
                if (filesize > limitFileSize) {
                    alert("文件大小超过限制，最大限制为：" + limitFileSize + 'M');
                    return false;
                }
            },
            beforeSend: function () {
                status.empty();
                var percentVal = '0%';
                bar.width(percentVal);
                percent.html(percentVal);
            },
            uploadProgress: function (event, position, total, percentComplete) {
                //position 已上传了多少
                //total 总大小
                //已上传的百分数
                var percentVal = percentComplete + '%';
                bar.width(percentVal)
                percent.html(percentVal);
                console.log(percentVal, position, total);
            },
            success: function (data) {
                console.log('success ---- ' + data.code);
                var percentVal = '100%';
                bar.width(percentVal);
                percent.html(percentVal);
                if (data.code == 200) {
                    alert('系统自动识别成功');
                } else {
                    alert(data.msg);
                }
            },
            error: function (err) {
                alert('系统自动识别异常');
            },
            complete: function (xhr) {
                var $data = JSON.parse(xhr.responseText); //由JSON字符串转换为JSON对象，json转成object
                console.log("------xhr.responseText------" + xhr.responseText);
                console.log("-------dasdasdsa-----" + $data);
                var $content
                if ($data.code == 200) {
                    $content = '<a href="###" class="list-group-item active">客户信息</a>' +
                        '<img alt="50x50" src="https://www.tinywan.com/tmp/' + $data.data.image_path + '" width="100%" height="420">' +
                        '<a href="###" class="list-group-item">姓名：' + $data.data.c_name + '</a>' +
                        '<a href="###" class="list-group-item">车牌号：' + $data.data.carCode + '</a>' +
                        '<a href="###" class="list-group-item">电话号：' + $data.data.c_tel + '</a>' +
                        '<a href="###" class="list-group-item">地址信息：' + $data.data.address + '</a>' +
                        '<a href="/tianchi/Index/killAllFFmpeg/id/' + $data.data.c_id + '" class="list-group-item">停止直播录像</a>';
                } else if ($data.code == 500) {
                    $content = '<h5 style="color:#dc143c;">' + $data.msg + '</h5>';
                } else {
                    $content = '未知错误，请检查表单提交';
                }
                $("#live_images").empty();
                $("#live_images").prepend($content);
            }
        });
    });

</script>
</body>
</html>